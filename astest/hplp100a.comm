# coding=utf-8
# --------------------------------------------------------------------
# Copyright (C) 1991 - 2025 - EDF R&D - www.code-aster.org
# This file is part of code_aster.
#
# code_aster is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# code_aster is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with code_aster.  If not, see <http://www.gnu.org/licenses/>.
# --------------------------------------------------------------------

#

DEBUT(CODE="OUI", DEBUG=_F(SDVERI="OUI"))

MA = LIRE_MAILLAGE(FORMAT="MED")

DEFI_GROUP(reuse=MA, MAILLAGE=MA, CREA_GROUP_NO=_F(NOM="GN3", GROUP_NO="N3"))


# -------------------------------------------------------------- #
#                       DEBUT DU THERMIQUE                       #
# -------------------------------------------------------------- #

MOTH = AFFE_MODELE(MAILLAGE=MA, AFFE=_F(TOUT="OUI", PHENOMENE="THERMIQUE", MODELISATION="PLAN"))

MATH = DEFI_MATERIAU(THER=_F(RHO_CP=0.0, LAMBDA=1.0))

CMTH = AFFE_MATERIAU(MAILLAGE=MA, AFFE=_F(TOUT="OUI", MATER=MATH))

CHTH = AFFE_CHAR_THER(
    MODELE=MOTH, TEMP_IMPO=(_F(GROUP_NO="GRNM1", TEMP=-100.0), _F(GROUP_NO="GRNM3", TEMP=100.0))
)

METH = CALC_MATR_ELEM(MODELE=MOTH, CHARGE=CHTH, CHAM_MATER=CMTH, OPTION="RIGI_THER")

VETH = CALC_VECT_ELEM(CHARGE=CHTH, OPTION="CHAR_THER")

NUTH = NUME_DDL(MATR_RIGI=METH)

KTH = ASSE_MATRICE(MATR_ELEM=METH, NUME_DDL=NUTH)

FTH = ASSE_VECTEUR(VECT_ELEM=VETH, NUME_DDL=NUTH)

KTH = FACTORISER(reuse=KTH, MATR_ASSE=KTH)

TEMP = RESOUDRE(MATR=KTH, CHAM_NO=FTH)

# -------------------------------------------------------------- #
#                       FIN DU THERMIQUE                         #
# -------------------------------------------------------------- #

MO = AFFE_MODELE(MAILLAGE=MA, AFFE=_F(TOUT="OUI", PHENOMENE="MECANIQUE", MODELISATION="D_PLAN"))

MAT = DEFI_MATERIAU(ELAS=_F(E=20000.0, NU=0.3, ALPHA=0.000005))

CM = AFFE_MATERIAU(
    MAILLAGE=MA,
    AFFE=_F(TOUT="OUI", MATER=MAT),
    AFFE_VARC=_F(NOM_VARC="TEMP", TOUT="OUI", CHAM_GD=TEMP, VALE_REF=0.0),
)

CH = AFFE_CHAR_MECA(
    MODELE=MO,
    # TEMP_CALCULEE=TEMP,
    DDL_IMPO=(
        _F(GROUP_NO="GRNM2", DY=0.0),
        _F(GROUP_NO="N695", DX=0.0),
        _F(GROUP_NO="GRNM4", DY=0.0),
    ),
)

ME = CALC_MATR_ELEM(MODELE=MO, CHARGE=CH, CHAM_MATER=CM, OPTION="RIGI_MECA")

# prise en compte des variables de commande

VE = CALC_VECT_ELEM(OPTION="FORC_VARC", CHAM_MATER=CM, MODELE=MO)

NU = NUME_DDL(MATR_RIGI=ME)

K = ASSE_MATRICE(MATR_ELEM=ME, NUME_DDL=NU)

F = ASSE_VECTEUR(VECT_ELEM=VE, NUME_DDL=NU)

K = FACTORISER(reuse=K, MATR_ASSE=K)

DEP = RESOUDRE(MATR=K, CHAM_NO=F)

RESU = CREA_RESU(
    OPERATION="AFFE",
    TYPE_RESU="EVOL_ELAS",
    AFFE=_F(NOM_CHAM="DEPL", CHAM_GD=DEP, INST=0.0, MODELE=MO, CHAM_MATER=CM),
)
FOND_NEW = DEFI_FOND_FISS(
    MAILLAGE=MA, FOND_FISS=_F(GROUP_NO="GN3"), SYME="OUI", LEVRE_SUP=_F(GROUP_MA="M388")
)
G1 = CALC_G(OPTION="G_EPSI", RESULTAT=RESU, THETA=_F(R_INF=10.0, R_SUP=40.0, FISSURE=FOND_NEW))

GK1 = CALC_G(
    RESULTAT=RESU,
    THETA=_F(R_INF=10.0, R_SUP=40.0, FISSURE=FOND_NEW),
    OPTION=("G_EPSI", "K", "KJ_EPSI"),
)

G2 = CALC_G(OPTION="G_EPSI", RESULTAT=RESU, THETA=_F(R_INF=15.0, R_SUP=45.0, FISSURE=FOND_NEW))

GK2 = CALC_G(
    RESULTAT=RESU,
    THETA=_F(R_INF=15.0, R_SUP=45.0, FISSURE=FOND_NEW),
    OPTION=("G_EPSI", "K", "KJ_EPSI"),
)

G3 = CALC_G(OPTION="G_EPSI", RESULTAT=RESU, THETA=_F(R_INF=5.0, R_SUP=47.0, FISSURE=FOND_NEW))

GK3 = CALC_G(
    RESULTAT=RESU,
    THETA=_F(R_INF=5.0, R_SUP=47.0, FISSURE=FOND_NEW),
    OPTION=("G_EPSI", "K", "KJ_EPSI"),
)

G4 = CALC_G(
    OPTION="G_EPSI", RESULTAT=RESU, NUME_ORDRE=1, THETA=_F(R_INF=3.0, R_SUP=48.0, FISSURE=FOND_NEW)
)

GK4 = CALC_G(
    RESULTAT=RESU,
    NUME_ORDRE=1,
    THETA=_F(R_INF=3.0, R_SUP=48.0, FISSURE=FOND_NEW),
    OPTION=("G_EPSI", "K", "KJ_EPSI"),
)


GK5 = CALC_G(
    RESULTAT=RESU, NUME_ORDRE=1, THETA=_F(FISSURE=FOND_NEW), OPTION=("G_EPSI", "K", "KJ_EPSI")
)


TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.360203432692,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_EPSI",
    TABLE=G1,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.360203432692,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_EPSI",
    TABLE=GK1,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.359636575533,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_IRWIN",
    TABLE=GK1,
)

TEST_TABLE(
    PRECISION=0.040000000000000001,
    VALE_CALC=88.9050086393,
    VALE_REFE=92.566000000000003,
    REFERENCE="NON_DEFINI",
    NOM_PARA="K1",
    TABLE=GK1,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=88.97504684052205,
    VALE_REFE=92.0291,
    REFERENCE="NON_DEFINI",
    NOM_PARA="KJ_EPSI",
    TABLE=GK1,
)

TEST_TABLE(CRITERE="ABSOLU", VALE_CALC=0.0, NOM_PARA="K2", TABLE=GK1)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.3601150977,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_EPSI",
    TABLE=G2,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.3601150977,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_EPSI",
    TABLE=GK2,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.35958185368,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_IRWIN",
    TABLE=GK2,
)

TEST_TABLE(
    PRECISION=0.040000000000000001,
    VALE_CALC=88.8982445444,
    VALE_REFE=92.566000000000003,
    REFERENCE="NON_DEFINI",
    NOM_PARA="K1",
    TABLE=GK2,
)

TEST_TABLE(CRITERE="ABSOLU", VALE_CALC=0.0, NOM_PARA="K2", TABLE=GK2)


TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=88.9641362116095,
    VALE_REFE=92.0291,
    REFERENCE="NON_DEFINI",
    NOM_PARA="KJ_EPSI",
    TABLE=GK2,
)


TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.360144312104,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_EPSI",
    TABLE=G3,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.360144312104,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_EPSI",
    TABLE=GK3,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.359614458429,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_IRWIN",
    TABLE=GK3,
)

TEST_TABLE(
    PRECISION=0.040000000000000001,
    VALE_CALC=88.9022748358,
    VALE_REFE=92.566000000000003,
    REFERENCE="NON_DEFINI",
    NOM_PARA="K1",
    TABLE=GK3,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=88.9677447543459,
    VALE_REFE=92.0291,
    REFERENCE="NON_DEFINI",
    NOM_PARA="KJ_EPSI",
    TABLE=GK3,
)

TEST_TABLE(CRITERE="ABSOLU", VALE_CALC=0.0, NOM_PARA="K2", TABLE=GK3)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.361844542614,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_EPSI",
    TABLE=GK5,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=0.361357632422,
    VALE_REFE=0.38985999999999998,
    REFERENCE="NON_DEFINI",
    NOM_PARA="G_IRWIN",
    TABLE=GK5,
)

TEST_TABLE(
    PRECISION=0.040000000000000001,
    VALE_CALC=89.1174841841,
    VALE_REFE=92.566000000000003,
    REFERENCE="NON_DEFINI",
    NOM_PARA="K1",
    TABLE=GK5,
)

TEST_TABLE(
    PRECISION=0.080000000000000002,
    VALE_CALC=89.17750450755094,
    VALE_REFE=92.0291,
    REFERENCE="NON_DEFINI",
    NOM_PARA="KJ_EPSI",
    TABLE=GK5,
)

TEST_TABLE(CRITERE="ABSOLU", VALE_CALC=0.0, NOM_PARA="K2", TABLE=GK5)

FIN()
#
