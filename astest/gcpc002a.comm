# coding=utf-8
# --------------------------------------------------------------------
# Copyright (C) 1991 - 2025 - EDF R&D - www.code-aster.org
# This file is part of code_aster.
#
# code_aster is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# code_aster is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with code_aster.  If not, see <http://www.gnu.org/licenses/>.
# --------------------------------------------------------------------

# TEST DE PERFORMANCE ANCIENNEMENT NOMME SSLV130E
# AUJOURD'HUI, CE TEST SERT A VALIDER LDLT_SP

DEBUT(CODE="OUI", DEBUG=_F(SDVERI="OUI"))

MA = LIRE_MAILLAGE(FORMAT="MED")

MO = AFFE_MODELE(MAILLAGE=MA, AFFE=_F(TOUT="OUI", PHENOMENE="MECANIQUE", MODELISATION="3D"))

MAT = DEFI_MATERIAU(ELAS=_F(E=210000.0, NU=0.3))

CHMAT = AFFE_MATERIAU(MAILLAGE=MA, AFFE=_F(TOUT="OUI", MATER=MAT))

CHA = AFFE_CHAR_MECA(
    MODELE=MO,
    DDL_IMPO=(
        _F(GROUP_NO="SUPY", DY=0.0),
        _F(GROUP_NO="APPUI", DX=0.0),
        _F(GROUP_NO="SUPZ", DZ=0.0),
        _F(GROUP_NO="CHARGE", DX=-1.0),
    ),
)

MEL = CALC_MATR_ELEM(OPTION="RIGI_MECA", MODELE=MO, CHAM_MATER=CHMAT, CHARGE=CHA)

NU = NUME_DDL(MATR_RIGI=MEL)

MATAS = ASSE_MATRICE(MATR_ELEM=MEL, NUME_DDL=NU)

VEL = CALC_VECT_ELEM(OPTION="CHAR_MECA", CHARGE=CHA)

VECAS = ASSE_VECTEUR(VECT_ELEM=VEL, NUME_DDL=NU)

# ----------------------------------------------------------------------
# GCPC + LDLT_INC
KMATAS = FACTORISER(MATR_ASSE=MATAS, METHODE="GCPC", PRE_COND="LDLT_INC")

DEP = RESOUDRE(
    MATR=MATAS, CHAM_NO=VECAS, RESI_RELA=1.0e-12, MATR_PREC=KMATAS, NMAX_ITER=1000, INFO=2
)


RESU = CREA_RESU(
    OPERATION="AFFE",
    TYPE_RESU="EVOL_ELAS",
    AFFE=_F(NOM_CHAM="DEPL", CHAM_GD=DEP, INST=0.0, MODELE=MO, CHAM_MATER=CHMAT),
)

RESU = CALC_CHAMP(reuse=RESU, RESULTAT=RESU, INST=0.0, CONTRAINTE=("SIGM_ELNO"))


TEST_RESU(
    CHAM_NO=(
        _F(GROUP_NO="NO13943", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.000658548946312),
        _F(GROUP_NO="NO13943", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=0.0644277136911),
        _F(GROUP_NO="NO13943", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=-0.00639262971453),
        _F(GROUP_NO="NO13944", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.000868313360965),
        _F(GROUP_NO="NO13944", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=0.0613567243152),
        _F(GROUP_NO="NO13944", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=-0.00622435434861),
        _F(GROUP_NO="NO15854", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.00113148283264),
        _F(GROUP_NO="NO15854", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=0.0587349558255),
        _F(GROUP_NO="NO15854", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=-0.00606448790099),
        _F(GROUP_NO="NO15855", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.00235371052492),
        _F(GROUP_NO="NO15855", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=0.0435509343418),
        _F(GROUP_NO="NO15855", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=-0.00453808740322),
        _F(GROUP_NO="NO15858", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.00317245366026),
        _F(GROUP_NO="NO15858", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=0.0282443770081),
        _F(GROUP_NO="NO15858", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=-0.00292784180373),
        _F(GROUP_NO="NO15860", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.00367588217329),
        _F(GROUP_NO="NO15860", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=0.0125845501803),
        _F(GROUP_NO="NO15860", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=-0.00121932658584),
        _F(GROUP_NO="NO15862", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.00383042029691),
        _F(GROUP_NO="NO15862", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=-0.00312782552608),
        _F(GROUP_NO="NO15862", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=0.00048319955506),
        _F(GROUP_NO="NO15863", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.00358353236508),
        _F(GROUP_NO="NO15863", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=-0.0189527976927),
        _F(GROUP_NO="NO15863", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=0.00215082919091),
        _F(GROUP_NO="NO15868", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.00295115700714),
        _F(GROUP_NO="NO15868", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=-0.0348509564365),
        _F(GROUP_NO="NO15868", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=0.00376792442609),
        _F(GROUP_NO="NO15869", NOM_CMP="DX", CHAM_GD=DEP, VALE_CALC=0.00173396377999),
        _F(GROUP_NO="NO15869", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=-0.0509950061445),
        _F(GROUP_NO="NO15869", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=0.00497486875618),
        _F(
            GROUP_NO="NO15866",
            CRITERE="ABSOLU",
            NOM_CMP="DX",
            CHAM_GD=DEP,
            VALE_CALC=4.04880321419e-14,
        ),
        _F(GROUP_NO="NO15866", NOM_CMP="DY", CHAM_GD=DEP, VALE_CALC=-0.0672259948328),
        _F(GROUP_NO="NO15866", NOM_CMP="DZ", CHAM_GD=DEP, VALE_CALC=0.00582039495858),
    )
)

# VALEUR DU TENSEUR DES CONTRAINTES PROVENANT D'UN CALCUL PAR PERMAS

TEST_RESU(
    RESU=(
        _F(
            INST=0.0,
            RESULTAT=RESU,
            NOM_CHAM="SIGM_ELNO",
            GROUP_NO="NO15854",
            NOM_CMP="SIXX",
            VALE_CALC=-3.55461086425,
            VALE_REFE=-3.5204,
            REFERENCE="SOURCE_EXTERNE",
            PRECISION=0.015,
            GROUP_MA="MA4204",
        ),
        _F(
            INST=0.0,
            RESULTAT=RESU,
            NOM_CHAM="SIGM_ELNO",
            GROUP_NO="NO15854",
            NOM_CMP="SIXY",
            VALE_CALC=-1.78556465973,
            VALE_REFE=-1.8101,
            REFERENCE="SOURCE_EXTERNE",
            PRECISION=0.015,
            GROUP_MA="MA4204",
        ),
        _F(
            INST=0.0,
            RESULTAT=RESU,
            NOM_CHAM="SIGM_ELNO",
            GROUP_NO="NO15854",
            NOM_CMP="SIYY",
            REFERENCE="SOURCE_EXTERNE",
            VALE_CALC=53.8840049983,
            VALE_REFE=53.884004983736,
            GROUP_MA="MA4204",
        ),
        _F(
            INST=0.0,
            RESULTAT=RESU,
            NOM_CHAM="SIGM_ELNO",
            GROUP_NO="NO15854",
            NOM_CMP="SIXZ",
            VALE_CALC=-0.695906802357,
            VALE_REFE=-0.7150,
            REFERENCE="SOURCE_EXTERNE",
            PRECISION=0.03,
            GROUP_MA="MA4204",
        ),
        _F(
            INST=0.0,
            RESULTAT=RESU,
            NOM_CHAM="SIGM_ELNO",
            GROUP_NO="NO15854",
            NOM_CMP="SIYZ",
            VALE_CALC=-1.03484325903,
            VALE_REFE=-1.03730,
            REFERENCE="SOURCE_EXTERNE",
            PRECISION=5.6e-3,
            GROUP_MA="MA4204",
        ),
        _F(
            INST=0.0,
            RESULTAT=RESU,
            NOM_CHAM="SIGM_ELNO",
            GROUP_NO="NO15854",
            NOM_CMP="SIZZ",
            VALE_CALC=-1.13193896654,
            VALE_REFE=-1.0672,
            REFERENCE="SOURCE_EXTERNE",
            PRECISION=0.065,
            GROUP_MA="MA4204",
        ),
    )
)

# ----------------------------------------------------------------------
# GCPC + LDLT_SP
MATAS = FACTORISER(reuse=MATAS, MATR_ASSE=MATAS, METHODE="GCPC", PRE_COND="LDLT_SP", PCENT_PIVOT=30)

DEP2 = RESOUDRE(MATR=MATAS, CHAM_NO=VECAS, RESI_RELA=1.0e-12, MATR_PREC=MATAS, INFO=2)

TEST_RESU(
    CHAM_NO=(
        _F(GROUP_NO="NO13943", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.000658548952509),
        _F(GROUP_NO="NO13943", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=0.0644277135535),
        _F(GROUP_NO="NO13943", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=-0.00639262970244),
        _F(GROUP_NO="NO13944", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.000868313366399),
        _F(GROUP_NO="NO13944", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=0.0613567241845),
        _F(GROUP_NO="NO13944", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=-0.00622435433652),
        _F(GROUP_NO="NO15854", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.00113148283712),
        _F(GROUP_NO="NO15854", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=0.0587349557008),
        _F(GROUP_NO="NO15854", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=-0.00606448788928),
        _F(GROUP_NO="NO15855", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.00235371052823),
        _F(GROUP_NO="NO15855", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=0.043550934249),
        _F(GROUP_NO="NO15855", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=-0.00453808739783),
        _F(GROUP_NO="NO15858", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.00317245366255),
        _F(GROUP_NO="NO15858", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=0.0282443769477),
        _F(GROUP_NO="NO15858", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=-0.00292784180233),
        _F(GROUP_NO="NO15860", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.00367588217332),
        _F(GROUP_NO="NO15860", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=0.0125845501535),
        _F(GROUP_NO="NO15860", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=-0.00121932658515),
        _F(GROUP_NO="NO15862", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.0038304202952),
        _F(GROUP_NO="NO15862", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=-0.00312782551886),
        _F(GROUP_NO="NO15862", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=0.000483199554458),
        _F(GROUP_NO="NO15863", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.00358353236308),
        _F(GROUP_NO="NO15863", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=-0.0189527976518),
        _F(GROUP_NO="NO15863", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=0.00215082918662),
        _F(GROUP_NO="NO15868", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.00295115700389),
        _F(GROUP_NO="NO15868", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=-0.034850956363),
        _F(GROUP_NO="NO15868", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=0.00376792441992),
        _F(GROUP_NO="NO15869", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.00173396377751),
        _F(GROUP_NO="NO15869", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=-0.0509950060382),
        _F(GROUP_NO="NO15869", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=0.00497486874717),
        _F(GROUP_NO="NO15866", CRITERE="ABSOLU", NOM_CMP="DX", CHAM_GD=DEP2, VALE_CALC=0.0),
        _F(GROUP_NO="NO15866", NOM_CMP="DY", CHAM_GD=DEP2, VALE_CALC=-0.0672259946912),
        _F(GROUP_NO="NO15866", NOM_CMP="DZ", CHAM_GD=DEP2, VALE_CALC=0.00582039494703),
    )
)
# ----------------------------------------------------------------------------------
# GCPC + LDLT_DP
MATAS2 = ASSE_MATRICE(MATR_ELEM=MEL, NUME_DDL=NU)
MATAS2 = FACTORISER(
    reuse=MATAS2, MATR_ASSE=MATAS2, METHODE="GCPC", PRE_COND="LDLT_DP", PCENT_PIVOT=30
)

DEP3 = RESOUDRE(MATR=MATAS2, CHAM_NO=VECAS, RESI_RELA=1.0e-12, MATR_PREC=MATAS2, INFO=2)

TEST_RESU(
    CHAM_NO=(
        _F(GROUP_NO="NO13943", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.000658548952509),
        _F(GROUP_NO="NO13943", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=0.0644277135535),
        _F(GROUP_NO="NO13943", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=-0.00639262970244),
        _F(GROUP_NO="NO13944", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.000868313366399),
        _F(GROUP_NO="NO13944", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=0.0613567241845),
        _F(GROUP_NO="NO13944", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=-0.00622435433652),
        _F(GROUP_NO="NO15854", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.00113148283712),
        _F(GROUP_NO="NO15854", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=0.0587349557008),
        _F(GROUP_NO="NO15854", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=-0.00606448788928),
        _F(GROUP_NO="NO15855", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.00235371052823),
        _F(GROUP_NO="NO15855", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=0.043550934249),
        _F(GROUP_NO="NO15855", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=-0.00453808739783),
        _F(GROUP_NO="NO15858", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.00317245366255),
        _F(GROUP_NO="NO15858", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=0.0282443769477),
        _F(GROUP_NO="NO15858", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=-0.00292784180233),
        _F(GROUP_NO="NO15860", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.00367588217332),
        _F(GROUP_NO="NO15860", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=0.0125845501535),
        _F(GROUP_NO="NO15860", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=-0.00121932658515),
        _F(GROUP_NO="NO15862", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.0038304202952),
        _F(GROUP_NO="NO15862", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=-0.00312782551886),
        _F(GROUP_NO="NO15862", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=0.000483199554458),
        _F(GROUP_NO="NO15863", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.00358353236308),
        _F(GROUP_NO="NO15863", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=-0.0189527976518),
        _F(GROUP_NO="NO15863", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=0.00215082918662),
        _F(GROUP_NO="NO15868", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.00295115700389),
        _F(GROUP_NO="NO15868", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=-0.034850956363),
        _F(GROUP_NO="NO15868", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=0.00376792441992),
        _F(GROUP_NO="NO15869", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.00173396377751),
        _F(GROUP_NO="NO15869", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=-0.0509950060382),
        _F(GROUP_NO="NO15869", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=0.00497486874717),
        _F(GROUP_NO="NO15866", CRITERE="ABSOLU", NOM_CMP="DX", CHAM_GD=DEP3, VALE_CALC=0.0),
        _F(GROUP_NO="NO15866", NOM_CMP="DY", CHAM_GD=DEP3, VALE_CALC=-0.0672259946912),
        _F(GROUP_NO="NO15866", NOM_CMP="DZ", CHAM_GD=DEP3, VALE_CALC=0.00582039494703),
    )
)
FIN()
