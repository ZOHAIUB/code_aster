# coding=utf-8
# --------------------------------------------------------------------
# Copyright (C) 1991 - 2025 - EDF R&D - www.code-aster.org
# This file is part of code_aster.
#
# code_aster is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# code_aster is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with code_aster.  If not, see <http://www.gnu.org/licenses/>.
# --------------------------------------------------------------------

# This test checks mesh spliting with more than only one ghost cell layers

from code_aster.Commands import *
from code_aster import CA
from code_aster.CA import MPI
import numpy as np

CA.init("--test", ERREUR=_F(ALARME="EXCEPTION"))

test = CA.TestCase()

rank = MPI.ASTER_COMM_WORLD.Get_rank()


def checkJoinSize(mesh, size, checker):
    graph = CA.CommGraph()

    dictProc = {}
    cmpt = 0
    for proc in mesh.getOppositeDomains():
        graph.addCommunication(proc)
        dictProc[proc] = cmpt
        cmpt += 1
    graph.synchronizeOverProcesses()

    matchings = graph.getMatchings()
    for procT in matchings:
        proc = procT[1]
        tag = procT[0]
        if proc == -1:
            continue
        numJoint = dictProc[proc]
        fJ = mesh.getSendJoint(numJoint)
        checker.assertEqual(len(fJ) / 2, size)
        sJ = mesh.getReceiveJoint(numJoint)
        checker.assertEqual(len(sJ) / 2, size)


# Mesh reading 1
mesh1 = CA.ParallelMesh()
mesh1.readMedFile("zzzz155l.med", ghost=3)

checkJoinSize(mesh1, 9, test)

test.assertTrue(mesh1.checkConsistency("zzzz155l.med"))
test.assertTrue(mesh1.checkJoints())

# Mesh reading 2
mesh2 = CA.ParallelMesh()
mesh2.readMedFile("petsc04a.mmed", ghost=2)

test.assertTrue(mesh2.checkConsistency("petsc04a.mmed"))
test.assertTrue(mesh2.checkJoints())

model = AFFE_MODELE(MAILLAGE=mesh2, AFFE=_F(TOUT="OUI", PHENOMENE="MECANIQUE", MODELISATION="3D"))

acier = DEFI_MATERIAU(ELAS=_F(E=200000.0, NU=0.3))

mater = AFFE_MATERIAU(MAILLAGE=mesh2, AFFE=_F(TOUT="OUI", MATER=acier))

cl = AFFE_CHAR_CINE(
    MODELE=model,
    MECA_IMPO=(_F(GROUP_MA="Zinf", DX=0.0, DY=0.0, DZ=0.0), _F(GROUP_MA="Zsup", DZ=1.0)),
)

resu = MECA_STATIQUE(MODELE=model, CHAM_MATER=mater, EXCIT=_F(CHARGE=cl), INST=0.0)

depl = resu.getField("DEPL", 1)
sDepl = depl.toSimpleFieldOnNodes()

if rank == 0:
    check = np.array(
        [
            [0.0, 0.0, 0.0],
            [0.12129471, -0.05771566, 0.19742066],
            [0.0576459, -0.0576459, 0.16463778],
            [0.0, 0.0, 0.0],
            [0.15800145, -0.09635294, 0.79521962],
            [0.09630591, -0.09630591, 0.79268427],
            [0.15805831, -0.09615219, 1.0],
            [0.09610172, -0.09610172, 1.0],
            [0.0, 0.0, 0.0],
            [0.12082714, -0.12082714, 0.22953619],
            [0.05771566, -0.12129471, 0.19742066],
            [0.0, 0.0, 0.0],
            [0.15744078, -0.15744078, 0.79806231],
            [0.09635294, -0.15800145, 0.79521962],
            [0.15778092, -0.15778092, 1.0],
            [0.09615219, -0.15805831, 1.0],
            [0.12493643, -0.01766223, 0.19456483],
            [0.12493643, 0.01766223, 0.19456483],
            [0.12129471, 0.05771566, 0.19742066],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.05906982, -0.01731819, 0.16164868],
            [0.05906982, 0.01731819, 0.16164868],
            [0.0576459, 0.0576459, 0.16463778],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.15896022, -0.03255027, 0.79220786],
            [0.15896022, 0.03255027, 0.79220786],
            [0.15800145, 0.09635294, 0.79521962],
            [0.14827431, -0.08851701, 0.39563771],
            [0.15662254, -0.0954175, 0.593016],
            [0.0968758, -0.03243327, 0.78982982],
            [0.0968758, 0.03243327, 0.78982982],
            [0.09630591, 0.09630591, 0.79268427],
            [0.08862635, -0.08862635, 0.37669205],
            [0.09549867, -0.09549867, 0.58532596],
            [0.15805831, 0.09615219, 1.0],
            [0.15868716, 0.03246033, 1.0],
            [0.15868716, -0.03246033, 1.0],
            [0.09645282, -0.03236276, 1.0],
            [0.09645282, 0.03236276, 1.0],
            [0.09610172, 0.09610172, 1.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.01731819, -0.05906982, 0.16164868],
            [-0.01731819, -0.05906982, 0.16164868],
            [-0.0576459, -0.0576459, 0.16463778],
            [0.14450643, -0.14450643, 0.41448362],
            [0.15526248, -0.15526248, 0.60130668],
            [0.08851701, -0.14827431, 0.39563771],
            [0.0954175, -0.15662254, 0.593016],
            [0.03243327, -0.0968758, 0.78982982],
            [-0.03243327, -0.0968758, 0.78982982],
            [-0.09630591, -0.09630591, 0.79268427],
            [0.03236276, -0.09645282, 1.0],
            [-0.03236276, -0.09645282, 1.0],
            [-0.09610172, -0.09610172, 1.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.01766223, -0.12493643, 0.19456483],
            [-0.01766223, -0.12493643, 0.19456483],
            [-0.05771566, -0.12129471, 0.19742066],
            [0.03255027, -0.15896022, 0.79220786],
            [-0.03255027, -0.15896022, 0.79220786],
            [-0.09635294, -0.15800145, 0.79521962],
            [0.03246033, -0.15868716, 1.0],
            [-0.03246033, -0.15868716, 1.0],
            [-0.09615219, -0.15805831, 1.0],
            [0.14827431, 0.08851701, 0.39563771],
            [0.15075415, 0.02863196, 0.38548821],
            [0.15075415, -0.02863196, 0.38548821],
            [0.15662254, 0.0954175, 0.593016],
            [0.1585823, 0.03237953, 0.58614555],
            [0.1585823, -0.03237953, 0.58614555],
            [0.08862635, 0.08862635, 0.37669205],
            [0.09549867, 0.09549867, 0.58532596],
            [0.0903933, 0.02833641, 0.36670733],
            [0.09662503, 0.03217095, 0.57854358],
            [0.0903933, -0.02833641, 0.36670733],
            [0.09662503, -0.03217095, 0.57854358],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.01777413, -0.01777413, 0.15881235],
            [-0.01777413, -0.01777413, 0.15881235],
            [-0.05906982, -0.01731819, 0.16164868],
            [0.01777413, 0.01777413, 0.15881235],
            [-0.01777413, 0.01777413, 0.15881235],
            [-0.05906982, 0.01731819, 0.16164868],
            [0.01731819, 0.05906982, 0.16164868],
            [-0.01731819, 0.05906982, 0.16164868],
            [-0.0576459, 0.0576459, 0.16463778],
            [0.03243327, 0.0968758, 0.78982982],
            [0.03260774, 0.03260774, 0.78687889],
            [0.03260774, -0.03260774, 0.78687889],
            [-0.03243327, 0.0968758, 0.78982982],
            [-0.03260774, 0.03260774, 0.78687889],
            [-0.03260774, -0.03260774, 0.78687889],
            [-0.09630591, 0.09630591, 0.79268427],
            [-0.0968758, 0.03243327, 0.78982982],
            [-0.0968758, -0.03243327, 0.78982982],
            [-0.08862635, -0.08862635, 0.37669205],
            [-0.09549867, -0.09549867, 0.58532596],
            [-0.02833641, -0.0903933, 0.36670733],
            [-0.03217095, -0.09662503, 0.57854358],
            [0.02833641, -0.0903933, 0.36670733],
            [0.03217095, -0.09662503, 0.57854358],
            [0.03248121, -0.03248121, 1.0],
            [-0.03248121, -0.03248121, 1.0],
            [-0.09645282, -0.03236276, 1.0],
            [0.03248121, 0.03248121, 1.0],
            [-0.03248121, 0.03248121, 1.0],
            [-0.09645282, 0.03236276, 1.0],
            [0.03236276, 0.09645282, 1.0],
            [-0.03236276, 0.09645282, 1.0],
            [-0.09610172, 0.09610172, 1.0],
            [-0.08851701, -0.14827431, 0.39563771],
            [-0.0954175, -0.15662254, 0.593016],
            [-0.02863196, -0.15075415, 0.38548821],
            [-0.03237953, -0.1585823, 0.58614555],
            [0.02863196, -0.15075415, 0.38548821],
            [0.03237953, -0.1585823, 0.58614555],
            [0.02833641, 0.0903933, 0.36670733],
            [-0.02833641, 0.0903933, 0.36670733],
            [-0.08862635, 0.08862635, 0.37669205],
            [0.03217095, 0.09662503, 0.57854358],
            [-0.03217095, 0.09662503, 0.57854358],
            [-0.09549867, 0.09549867, 0.58532596],
            [0.02878477, 0.02878477, 0.35650122],
            [-0.02878477, 0.02878477, 0.35650122],
            [-0.0903933, 0.02833641, 0.36670733],
            [0.03251581, 0.03251581, 0.57163032],
            [-0.03251581, 0.03251581, 0.57163032],
            [-0.09662503, 0.03217095, 0.57854358],
            [0.02878477, -0.02878477, 0.35650122],
            [-0.02878477, -0.02878477, 0.35650122],
            [-0.0903933, -0.02833641, 0.36670733],
            [0.03251581, -0.03251581, 0.57163032],
            [-0.03251581, -0.03251581, 0.57163032],
            [-0.09662503, -0.03217095, 0.57854358],
        ]
    )
elif rank == 1:
    check = np.array(
        [
            [0.0968758, -0.03243327, 0.78982982],
            [0.0968758, 0.03243327, 0.78982982],
            [0.09630591, 0.09630591, 0.79268427],
            [0.08862635, -0.08862635, 0.37669205],
            [0.09549867, -0.09549867, 0.58532596],
            [0.09645282, -0.03236276, 1.0],
            [0.09645282, 0.03236276, 1.0],
            [0.09610172, 0.09610172, 1.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [-0.12129471, 0.05771566, 0.19742066],
            [-0.12493643, 0.01766223, 0.19456483],
            [-0.12493643, -0.01766223, 0.19456483],
            [0.01731819, -0.05906982, 0.16164868],
            [-0.01731819, -0.05906982, 0.16164868],
            [-0.0576459, -0.0576459, 0.16463778],
            [0.08851701, -0.14827431, 0.39563771],
            [0.0954175, -0.15662254, 0.593016],
            [0.03243327, -0.0968758, 0.78982982],
            [-0.03243327, -0.0968758, 0.78982982],
            [-0.09630591, -0.09630591, 0.79268427],
            [-0.15800145, 0.09635294, 0.79521962],
            [-0.15896022, 0.03255027, 0.79220786],
            [-0.15896022, -0.03255027, 0.79220786],
            [-0.14827431, -0.08851701, 0.39563771],
            [-0.15662254, -0.0954175, 0.593016],
            [0.03236276, -0.09645282, 1.0],
            [-0.03236276, -0.09645282, 1.0],
            [0.0576459, -0.0576459, 0.16463778],
            [0.0, 0.0, 0.0],
            [0.09630591, -0.09630591, 0.79268427],
            [0.09610172, -0.09610172, 1.0],
            [0.05771566, -0.12129471, 0.19742066],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [-0.12129471, -0.05771566, 0.19742066],
            [0.09635294, -0.15800145, 0.79521962],
            [0.09615219, -0.15805831, 1.0],
            [-0.15800145, -0.09635294, 0.79521962],
            [-0.15805831, -0.09615219, 1.0],
            [0.0, 0.0, 0.0],
            [-0.12082714, -0.12082714, 0.22953619],
            [-0.15744078, -0.15744078, 0.79806231],
            [-0.15778092, -0.15778092, 1.0],
            [0.05906982, -0.01731819, 0.16164868],
            [0.05906982, 0.01731819, 0.16164868],
            [0.0576459, 0.0576459, 0.16463778],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.03243327, 0.0968758, 0.78982982],
            [0.03260774, 0.03260774, 0.78687889],
            [0.03260774, -0.03260774, 0.78687889],
            [-0.03243327, 0.0968758, 0.78982982],
            [-0.03260774, 0.03260774, 0.78687889],
            [-0.03260774, -0.03260774, 0.78687889],
            [-0.09630591, 0.09630591, 0.79268427],
            [-0.0968758, 0.03243327, 0.78982982],
            [-0.0968758, -0.03243327, 0.78982982],
            [-0.08862635, -0.08862635, 0.37669205],
            [-0.09549867, -0.09549867, 0.58532596],
            [-0.02833641, -0.0903933, 0.36670733],
            [-0.03217095, -0.09662503, 0.57854358],
            [0.02833641, -0.0903933, 0.36670733],
            [0.03217095, -0.09662503, 0.57854358],
            [-0.15662254, 0.0954175, 0.593016],
            [-0.1585823, 0.03237953, 0.58614555],
            [-0.1585823, -0.03237953, 0.58614555],
            [-0.14827431, 0.08851701, 0.39563771],
            [-0.15075415, 0.02863196, 0.38548821],
            [-0.15075415, -0.02863196, 0.38548821],
            [0.03248121, -0.03248121, 1.0],
            [-0.03248121, -0.03248121, 1.0],
            [-0.09645282, -0.03236276, 1.0],
            [0.03248121, 0.03248121, 1.0],
            [-0.03248121, 0.03248121, 1.0],
            [-0.09645282, 0.03236276, 1.0],
            [0.03236276, 0.09645282, 1.0],
            [-0.03236276, 0.09645282, 1.0],
            [-0.09610172, 0.09610172, 1.0],
            [-0.08851701, -0.14827431, 0.39563771],
            [-0.0954175, -0.15662254, 0.593016],
            [-0.02863196, -0.15075415, 0.38548821],
            [-0.03237953, -0.1585823, 0.58614555],
            [0.02863196, -0.15075415, 0.38548821],
            [0.03237953, -0.1585823, 0.58614555],
            [0.02833641, 0.0903933, 0.36670733],
            [-0.02833641, 0.0903933, 0.36670733],
            [-0.08862635, 0.08862635, 0.37669205],
            [0.03217095, 0.09662503, 0.57854358],
            [-0.03217095, 0.09662503, 0.57854358],
            [-0.09549867, 0.09549867, 0.58532596],
            [0.02878477, 0.02878477, 0.35650122],
            [-0.02878477, 0.02878477, 0.35650122],
            [-0.0903933, 0.02833641, 0.36670733],
            [0.03251581, 0.03251581, 0.57163032],
            [-0.03251581, 0.03251581, 0.57163032],
            [-0.09662503, 0.03217095, 0.57854358],
            [0.02878477, -0.02878477, 0.35650122],
            [-0.02878477, -0.02878477, 0.35650122],
            [-0.0903933, -0.02833641, 0.36670733],
            [0.03251581, -0.03251581, 0.57163032],
            [-0.03251581, -0.03251581, 0.57163032],
            [-0.09662503, -0.03217095, 0.57854358],
            [-0.09610172, -0.09610172, 1.0],
            [-0.15805831, 0.09615219, 1.0],
            [-0.15868716, 0.03246033, 1.0],
            [-0.15868716, -0.03246033, 1.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.01766223, -0.12493643, 0.19456483],
            [-0.01766223, -0.12493643, 0.19456483],
            [-0.05771566, -0.12129471, 0.19742066],
            [0.03255027, -0.15896022, 0.79220786],
            [-0.03255027, -0.15896022, 0.79220786],
            [-0.09635294, -0.15800145, 0.79521962],
            [-0.14450643, -0.14450643, 0.41448362],
            [-0.15526248, -0.15526248, 0.60130668],
            [0.03246033, -0.15868716, 1.0],
            [-0.03246033, -0.15868716, 1.0],
            [-0.09615219, -0.15805831, 1.0],
            [0.08862635, 0.08862635, 0.37669205],
            [0.09549867, 0.09549867, 0.58532596],
            [0.0903933, 0.02833641, 0.36670733],
            [0.09662503, 0.03217095, 0.57854358],
            [0.0903933, -0.02833641, 0.36670733],
            [0.09662503, -0.03217095, 0.57854358],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.01777413, -0.01777413, 0.15881235],
            [-0.01777413, -0.01777413, 0.15881235],
            [-0.05906982, -0.01731819, 0.16164868],
            [0.01777413, 0.01777413, 0.15881235],
            [-0.01777413, 0.01777413, 0.15881235],
            [-0.05906982, 0.01731819, 0.16164868],
            [0.01731819, 0.05906982, 0.16164868],
            [-0.01731819, 0.05906982, 0.16164868],
            [-0.0576459, 0.0576459, 0.16463778],
        ]
    )
elif rank == 2:
    check = np.array(
        [
            [-0.09610172, -0.09610172, 1.0],
            [-0.15805831, 0.09615219, 1.0],
            [-0.15868716, 0.03246033, 1.0],
            [-0.15868716, -0.03246033, 1.0],
            [0.14827431, 0.08851701, 0.39563771],
            [0.15075415, 0.02863196, 0.38548821],
            [0.15075415, -0.02863196, 0.38548821],
            [0.15662254, 0.0954175, 0.593016],
            [0.1585823, 0.03237953, 0.58614555],
            [0.1585823, -0.03237953, 0.58614555],
            [0.08862635, 0.08862635, 0.37669205],
            [0.09549867, 0.09549867, 0.58532596],
            [0.0903933, 0.02833641, 0.36670733],
            [0.09662503, 0.03217095, 0.57854358],
            [0.0903933, -0.02833641, 0.36670733],
            [0.09662503, -0.03217095, 0.57854358],
            [0.01777413, -0.01777413, 0.15881235],
            [-0.01777413, -0.01777413, 0.15881235],
            [-0.05906982, -0.01731819, 0.16164868],
            [0.01777413, 0.01777413, 0.15881235],
            [-0.01777413, 0.01777413, 0.15881235],
            [-0.05906982, 0.01731819, 0.16164868],
            [0.01731819, 0.05906982, 0.16164868],
            [-0.01731819, 0.05906982, 0.16164868],
            [-0.0576459, 0.0576459, 0.16463778],
            [0.02863196, 0.15075415, 0.38548821],
            [0.03237953, 0.1585823, 0.58614555],
            [-0.02863196, 0.15075415, 0.38548821],
            [-0.03237953, 0.1585823, 0.58614555],
            [-0.08851701, 0.14827431, 0.39563771],
            [-0.0954175, 0.15662254, 0.593016],
            [0.03243327, 0.0968758, 0.78982982],
            [0.03260774, 0.03260774, 0.78687889],
            [0.03260774, -0.03260774, 0.78687889],
            [-0.03243327, 0.0968758, 0.78982982],
            [-0.03260774, 0.03260774, 0.78687889],
            [-0.03260774, -0.03260774, 0.78687889],
            [-0.09630591, 0.09630591, 0.79268427],
            [-0.0968758, 0.03243327, 0.78982982],
            [-0.0968758, -0.03243327, 0.78982982],
            [-0.08862635, -0.08862635, 0.37669205],
            [-0.09549867, -0.09549867, 0.58532596],
            [-0.02833641, -0.0903933, 0.36670733],
            [-0.03217095, -0.09662503, 0.57854358],
            [0.02833641, -0.0903933, 0.36670733],
            [0.03217095, -0.09662503, 0.57854358],
            [-0.15662254, 0.0954175, 0.593016],
            [-0.1585823, 0.03237953, 0.58614555],
            [-0.1585823, -0.03237953, 0.58614555],
            [-0.14827431, 0.08851701, 0.39563771],
            [-0.15075415, 0.02863196, 0.38548821],
            [-0.15075415, -0.02863196, 0.38548821],
            [0.03248121, -0.03248121, 1.0],
            [-0.03248121, -0.03248121, 1.0],
            [-0.09645282, -0.03236276, 1.0],
            [0.03248121, 0.03248121, 1.0],
            [-0.03248121, 0.03248121, 1.0],
            [-0.09645282, 0.03236276, 1.0],
            [0.03236276, 0.09645282, 1.0],
            [-0.03236276, 0.09645282, 1.0],
            [-0.09610172, 0.09610172, 1.0],
            [0.02833641, 0.0903933, 0.36670733],
            [-0.02833641, 0.0903933, 0.36670733],
            [-0.08862635, 0.08862635, 0.37669205],
            [0.03217095, 0.09662503, 0.57854358],
            [-0.03217095, 0.09662503, 0.57854358],
            [-0.09549867, 0.09549867, 0.58532596],
            [0.02878477, 0.02878477, 0.35650122],
            [-0.02878477, 0.02878477, 0.35650122],
            [-0.0903933, 0.02833641, 0.36670733],
            [0.03251581, 0.03251581, 0.57163032],
            [-0.03251581, 0.03251581, 0.57163032],
            [-0.09662503, 0.03217095, 0.57854358],
            [0.02878477, -0.02878477, 0.35650122],
            [-0.02878477, -0.02878477, 0.35650122],
            [-0.0903933, -0.02833641, 0.36670733],
            [0.03251581, -0.03251581, 0.57163032],
            [-0.03251581, -0.03251581, 0.57163032],
            [-0.09662503, -0.03217095, 0.57854358],
            [0.12129471, -0.05771566, 0.19742066],
            [0.12082714, 0.12082714, 0.22953619],
            [0.05771566, 0.12129471, 0.19742066],
            [0.0576459, -0.0576459, 0.16463778],
            [0.15800145, -0.09635294, 0.79521962],
            [0.15744078, 0.15744078, 0.79806231],
            [0.09635294, 0.15800145, 0.79521962],
            [0.09630591, -0.09630591, 0.79268427],
            [0.15805831, -0.09615219, 1.0],
            [0.15778092, 0.15778092, 1.0],
            [0.09615219, 0.15805831, 1.0],
            [0.09610172, -0.09610172, 1.0],
            [-0.12082714, 0.12082714, 0.22953619],
            [-0.12129471, -0.05771566, 0.19742066],
            [-0.15744078, 0.15744078, 0.79806231],
            [-0.15800145, -0.09635294, 0.79521962],
            [-0.15778092, 0.15778092, 1.0],
            [-0.15805831, -0.09615219, 1.0],
            [0.12493643, -0.01766223, 0.19456483],
            [0.12493643, 0.01766223, 0.19456483],
            [0.12129471, 0.05771566, 0.19742066],
            [0.05906982, -0.01731819, 0.16164868],
            [0.05906982, 0.01731819, 0.16164868],
            [0.0576459, 0.0576459, 0.16463778],
            [0.14450643, 0.14450643, 0.41448362],
            [0.15526248, 0.15526248, 0.60130668],
            [0.15896022, -0.03255027, 0.79220786],
            [0.15896022, 0.03255027, 0.79220786],
            [0.15800145, 0.09635294, 0.79521962],
            [0.14827431, -0.08851701, 0.39563771],
            [0.15662254, -0.0954175, 0.593016],
            [0.0954175, 0.15662254, 0.593016],
            [0.08851701, 0.14827431, 0.39563771],
            [0.0968758, -0.03243327, 0.78982982],
            [0.0968758, 0.03243327, 0.78982982],
            [0.09630591, 0.09630591, 0.79268427],
            [0.08862635, -0.08862635, 0.37669205],
            [0.09549867, -0.09549867, 0.58532596],
            [0.15805831, 0.09615219, 1.0],
            [0.15868716, 0.03246033, 1.0],
            [0.15868716, -0.03246033, 1.0],
            [0.09645282, -0.03236276, 1.0],
            [0.09645282, 0.03236276, 1.0],
            [0.09610172, 0.09610172, 1.0],
            [0.01766223, 0.12493643, 0.19456483],
            [-0.01766223, 0.12493643, 0.19456483],
            [-0.05771566, 0.12129471, 0.19742066],
            [-0.12129471, 0.05771566, 0.19742066],
            [-0.12493643, 0.01766223, 0.19456483],
            [-0.12493643, -0.01766223, 0.19456483],
            [0.01731819, -0.05906982, 0.16164868],
            [-0.01731819, -0.05906982, 0.16164868],
            [-0.0576459, -0.0576459, 0.16463778],
            [-0.14450643, 0.14450643, 0.41448362],
            [-0.15526248, 0.15526248, 0.60130668],
            [0.03255027, 0.15896022, 0.79220786],
            [-0.03255027, 0.15896022, 0.79220786],
            [-0.09635294, 0.15800145, 0.79521962],
            [0.03243327, -0.0968758, 0.78982982],
            [-0.03243327, -0.0968758, 0.78982982],
            [-0.09630591, -0.09630591, 0.79268427],
            [-0.15800145, 0.09635294, 0.79521962],
            [-0.15896022, 0.03255027, 0.79220786],
            [-0.15896022, -0.03255027, 0.79220786],
            [-0.14827431, -0.08851701, 0.39563771],
            [-0.15662254, -0.0954175, 0.593016],
            [0.03246033, 0.15868716, 1.0],
            [-0.03246033, 0.15868716, 1.0],
            [-0.09615219, 0.15805831, 1.0],
            [0.03236276, -0.09645282, 1.0],
            [-0.03236276, -0.09645282, 1.0],
        ]
    )
elif rank == 3:
    check = np.array(
        [
            [0.03243327, 0.0968758, 0.78982982],
            [0.03260774, 0.03260774, 0.78687889],
            [0.03260774, -0.03260774, 0.78687889],
            [-0.03243327, 0.0968758, 0.78982982],
            [-0.03260774, 0.03260774, 0.78687889],
            [-0.03260774, -0.03260774, 0.78687889],
            [-0.09630591, 0.09630591, 0.79268427],
            [-0.0968758, 0.03243327, 0.78982982],
            [-0.0968758, -0.03243327, 0.78982982],
            [-0.08862635, -0.08862635, 0.37669205],
            [-0.09549867, -0.09549867, 0.58532596],
            [-0.02833641, -0.0903933, 0.36670733],
            [-0.03217095, -0.09662503, 0.57854358],
            [0.02833641, -0.0903933, 0.36670733],
            [0.03217095, -0.09662503, 0.57854358],
            [-0.15662254, 0.0954175, 0.593016],
            [-0.1585823, 0.03237953, 0.58614555],
            [-0.1585823, -0.03237953, 0.58614555],
            [-0.14827431, 0.08851701, 0.39563771],
            [-0.15075415, 0.02863196, 0.38548821],
            [-0.15075415, -0.02863196, 0.38548821],
            [0.02833641, 0.0903933, 0.36670733],
            [-0.02833641, 0.0903933, 0.36670733],
            [-0.08862635, 0.08862635, 0.37669205],
            [0.03217095, 0.09662503, 0.57854358],
            [-0.03217095, 0.09662503, 0.57854358],
            [-0.09549867, 0.09549867, 0.58532596],
            [0.02878477, 0.02878477, 0.35650122],
            [-0.02878477, 0.02878477, 0.35650122],
            [-0.0903933, 0.02833641, 0.36670733],
            [0.03251581, 0.03251581, 0.57163032],
            [-0.03251581, 0.03251581, 0.57163032],
            [-0.09662503, 0.03217095, 0.57854358],
            [0.02878477, -0.02878477, 0.35650122],
            [-0.02878477, -0.02878477, 0.35650122],
            [-0.0903933, -0.02833641, 0.36670733],
            [0.03251581, -0.03251581, 0.57163032],
            [-0.03251581, -0.03251581, 0.57163032],
            [-0.09662503, -0.03217095, 0.57854358],
            [0.14827431, 0.08851701, 0.39563771],
            [0.15075415, 0.02863196, 0.38548821],
            [0.15075415, -0.02863196, 0.38548821],
            [0.15662254, 0.0954175, 0.593016],
            [0.1585823, 0.03237953, 0.58614555],
            [0.1585823, -0.03237953, 0.58614555],
            [0.08862635, 0.08862635, 0.37669205],
            [0.09549867, 0.09549867, 0.58532596],
            [0.0903933, 0.02833641, 0.36670733],
            [0.09662503, 0.03217095, 0.57854358],
            [0.0903933, -0.02833641, 0.36670733],
            [0.09662503, -0.03217095, 0.57854358],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.01777413, -0.01777413, 0.15881235],
            [-0.01777413, -0.01777413, 0.15881235],
            [-0.05906982, -0.01731819, 0.16164868],
            [0.01777413, 0.01777413, 0.15881235],
            [-0.01777413, 0.01777413, 0.15881235],
            [-0.05906982, 0.01731819, 0.16164868],
            [0.01731819, 0.05906982, 0.16164868],
            [-0.01731819, 0.05906982, 0.16164868],
            [-0.0576459, 0.0576459, 0.16463778],
            [0.02863196, 0.15075415, 0.38548821],
            [0.03237953, 0.1585823, 0.58614555],
            [-0.02863196, 0.15075415, 0.38548821],
            [-0.03237953, 0.1585823, 0.58614555],
            [-0.08851701, 0.14827431, 0.39563771],
            [-0.0954175, 0.15662254, 0.593016],
            [0.15662254, -0.0954175, 0.593016],
            [0.0954175, 0.15662254, 0.593016],
            [0.08851701, 0.14827431, 0.39563771],
            [0.0968758, -0.03243327, 0.78982982],
            [0.0968758, 0.03243327, 0.78982982],
            [0.09630591, 0.09630591, 0.79268427],
            [0.08862635, -0.08862635, 0.37669205],
            [0.09549867, -0.09549867, 0.58532596],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.01766223, 0.12493643, 0.19456483],
            [-0.01766223, 0.12493643, 0.19456483],
            [-0.05771566, 0.12129471, 0.19742066],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [-0.12129471, 0.05771566, 0.19742066],
            [-0.12493643, 0.01766223, 0.19456483],
            [-0.12493643, -0.01766223, 0.19456483],
            [0.01731819, -0.05906982, 0.16164868],
            [-0.01731819, -0.05906982, 0.16164868],
            [-0.0576459, -0.0576459, 0.16463778],
            [-0.14450643, 0.14450643, 0.41448362],
            [-0.15526248, 0.15526248, 0.60130668],
            [0.03255027, 0.15896022, 0.79220786],
            [-0.03255027, 0.15896022, 0.79220786],
            [-0.09635294, 0.15800145, 0.79521962],
            [0.03243327, -0.0968758, 0.78982982],
            [-0.03243327, -0.0968758, 0.78982982],
            [-0.09630591, -0.09630591, 0.79268427],
            [-0.15800145, 0.09635294, 0.79521962],
            [-0.15896022, 0.03255027, 0.79220786],
            [-0.15896022, -0.03255027, 0.79220786],
            [-0.14827431, -0.08851701, 0.39563771],
            [-0.15662254, -0.0954175, 0.593016],
            [0.0, 0.0, 0.0],
            [0.12129471, -0.05771566, 0.19742066],
            [0.12082714, 0.12082714, 0.22953619],
            [0.0, 0.0, 0.0],
            [0.05771566, 0.12129471, 0.19742066],
            [0.0, 0.0, 0.0],
            [0.0576459, -0.0576459, 0.16463778],
            [0.0, 0.0, 0.0],
            [0.15800145, -0.09635294, 0.79521962],
            [0.15744078, 0.15744078, 0.79806231],
            [0.09635294, 0.15800145, 0.79521962],
            [0.09630591, -0.09630591, 0.79268427],
            [-0.12082714, 0.12082714, 0.22953619],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [-0.12129471, -0.05771566, 0.19742066],
            [-0.15744078, 0.15744078, 0.79806231],
            [-0.15800145, -0.09635294, 0.79521962],
            [0.12493643, -0.01766223, 0.19456483],
            [0.12493643, 0.01766223, 0.19456483],
            [0.12129471, 0.05771566, 0.19742066],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.05906982, -0.01731819, 0.16164868],
            [0.05906982, 0.01731819, 0.16164868],
            [0.0576459, 0.0576459, 0.16463778],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0],
            [0.14450643, 0.14450643, 0.41448362],
            [0.15526248, 0.15526248, 0.60130668],
            [0.15896022, -0.03255027, 0.79220786],
            [0.15896022, 0.03255027, 0.79220786],
            [0.15800145, 0.09635294, 0.79521962],
            [0.14827431, -0.08851701, 0.39563771],
        ]
    )

test.assertAlmostEqual(abs(sDepl.toNumpy()[0] - check).max(), 0.0)
FIN()
